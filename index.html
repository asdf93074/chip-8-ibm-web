<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CHIP-8 - IBM ROM</title>
    <script src="emu.js"></script>
    <script>
      const rom = [
        0x00, 0xe0, 0xa2, 0x2a, 0x60, 0x0c, 0x61, 0x08, 0xd0, 0x1f, 0x70, 0x09, 0xa2, 0x39, 0xd0, 0x1f,
        0xa2, 0x48, 0x70, 0x08, 0xd0, 0x1f, 0x70, 0x04, 0xa2, 0x57, 0xd0, 0x1f, 0x70, 0x08, 0xa2, 0x66,
        0xd0, 0x1f, 0x70, 0x08, 0xa2, 0x75, 0xd0, 0x1f, 0x12, 0x28, 0xff, 0x00, 0xff, 0x00, 0x3c, 0x00,
        0x3c, 0x00, 0x3c, 0x00, 0x3c, 0x00, 0xff, 0x00, 0xff, 0xff, 0x00, 0xff, 0x00, 0x38, 0x00, 0x3f,
        0x00, 0x3f, 0x00, 0x38, 0x00, 0xff, 0x00, 0xff, 0x80, 0x00, 0xe0, 0x00, 0xe0, 0x00, 0x80, 0x00,
        0x80, 0x00, 0xe0, 0x00, 0xe0, 0x00, 0x80, 0xf8, 0x00, 0xfc, 0x00, 0x3e, 0x00, 0x3f, 0x00, 0x3b,
        0x00, 0x39, 0x00, 0xf8, 0x00, 0xf8, 0x03, 0x00, 0x07, 0x00, 0x0f, 0x00, 0xbf, 0x00, 0xfb, 0x00,
        0xf3, 0x00, 0xe3, 0x00, 0x43, 0xe0, 0x00, 0xe0, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80,
        0x00, 0xe0, 0x00, 0xe0
      ];
    </script>
</head>
<body>
    <div id="app">
      <canvas id="canvas" width="640px" height="320px"></canvas>
    </div>
    <script>
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      let interval;
      const h = 32;
      const w = 64;

      const screenNodes = [];

      const draw = () => {
        for (let i = 0; i < h; i++) {
          for (let j = 0; j < w; j++) {
            drawPixel(ctx, j, i, display[i][j]);
          }
        }
      };

      const clearScreen = () => {
        screen.fill(0);
      };

      const drawPixel = (context, x, y, val) => {
        context.fillStyle = val ? 'white' : 'black';
        context.fillRect(x * 10, y * 10, 10, 10);
      };

      const changeSpeed = (value) => {
        clearInterval(interval);
        interval = setInterval(() => {cycle(draw, 800/value)}, 800/value);
      };

      draw();

      loadProgram(rom);

      const start = () => {
        interval = setTimeout(() => {cycle(draw, 800/700)}, 800/700);
      }
      start();
    </script>
</body>
</html>